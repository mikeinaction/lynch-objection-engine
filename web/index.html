<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lynch Objection Engine</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, Helvetica, sans-serif; background:#f6f7f9; margin:0; }

    .wrap { max-width: 900px; margin: 0 auto; padding: 18px; }
    .card {
      background:#fff;
      border:1px solid #e6e8ee;
      border-radius:14px;
      padding:18px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.05);
    }

    h1 { margin:0 0 6px 0; font-size: 20px; }
    .sub { margin:0 0 12px 0; color:#555; font-size: 13px; line-height: 1.35; }

    .status {
      display:flex;
      align-items:center;
      gap:10px;
      margin: 10px 0 14px 0;
      font-size: 12px;
      color:#444;
    }
    .dot {
      width:10px; height:10px; border-radius:50%;
      background:#bbb;
      display:inline-block;
    }
    .dot.ready { background:#28a745; }
    .dot.busy { background:#f0ad4e; }
    .dot.err  { background:#dc3545; }

    /* Chat layout */
    .chatShell {
      height: calc(100vh - 170px); /* keeps input visible and avoids overlap */
      min-height: 420px;
      display:flex;
      flex-direction: column;
      border: 1px solid #eef0f5;
      border-radius: 12px;
      overflow: hidden;
      background: #fbfbfd;
    }

    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 14px;
      display:flex;
      flex-direction: column;
      gap: 10px;
    }

    .msgRow { display:flex; }
    .msgRow.user { justify-content: flex-end; }
    .msgRow.bot { justify-content: flex-start; }

    .bubble {
      max-width: 82%;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid #e6e8ee;
      background: #fff;
      font-size: 14px;
      line-height: 1.35;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .bubble.user {
      background:#0b5fff;
      border-color:#0b5fff;
      color:#fff;
      border-bottom-right-radius: 6px;
    }
    .bubble.bot {
      background:#ffffff;
      border-bottom-left-radius: 6px;
    }
    .bubble.err {
      border-color: #dc3545;
      background:#fff5f5;
    }

    .composer {
      border-top: 1px solid #eef0f5;
      background:#fff;
      padding: 10px;
      display:flex;
      gap: 10px;
      align-items: flex-end;
    }

    textarea {
      width: 100%;
      min-height: 44px;
      max-height: 140px;
      padding: 10px 12px;
      border-radius: 10px;
      border:1px solid #cfd6e4;
      font-size: 14px;
      resize: none;
      outline: none;
    }
    textarea:focus { border-color:#0b5fff; }

    button {
      height: 44px;
      padding: 0 14px;
      border:0;
      border-radius: 10px;
      background:#0b5fff;
      color:#fff;
      font-weight: 700;
      cursor:pointer;
      white-space: nowrap;
    }
    button:disabled { opacity:0.6; cursor:not-allowed; }

    .hint {
      margin-top: 10px;
      font-size: 12px;
      color:#666;
    }
    code { background:#f1f3f7; padding:2px 5px; border-radius:6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Lynch Objection Engine</h1>
      <p class="sub">
        Type an objection below. Press <code>Enter</code> to send.
        Use <code>Shift + Enter</code> for a new line.
      </p>

      <div class="status">
        <span id="dot" class="dot ready"></span>
        <span id="statusText">Ready</span>
      </div>

      <div class="chatShell">
        <div id="messages" class="messages"></div>

        <div class="composer">
          <textarea id="input" placeholder="Type your objection..."></textarea>
          <button id="sendBtn">Send</button>
        </div>
      </div>

      <div class="hint">
        If you ever redeploy and the API changes, update the <code>API_URL</code> in this file.
      </div>
    </div>
  </div>

  <script>
<<<<<<< HEAD
    // Updated API endpoint
=======
    // IMPORTANT: this is your live API endpoint
>>>>>>> f720a1c (Ignore build artifacts and update API endpoint)
    const API_URL = "https://69cnmprz12.execute-api.us-east-1.amazonaws.com/ask";

    const messagesEl = document.getElementById("messages");
    const input = document.getElementById("input");
    const sendBtn = document.getElementById("sendBtn");
    const dot = document.getElementById("dot");
    const statusText = document.getElementById("statusText");

    function setStatus(text, mode) {
      statusText.textContent = text;
      dot.classList.remove("ready", "busy", "err");
      if (mode === "busy") dot.classList.add("busy");
      else if (mode === "err") dot.classList.add("err");
      else dot.classList.add("ready");
    }

    function addMessage(text, who, isError) {
      const row = document.createElement("div");
      row.className = `msgRow ${who}`;

      const bubble = document.createElement("div");
      bubble.className = `bubble ${who}` + (isError ? " err" : "");
      bubble.textContent = text;

      row.appendChild(bubble);
      messagesEl.appendChild(row);

      // keep newest messages visible (input stays pinned at bottom)
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function autoGrow(el) {
      el.style.height = "auto";
      el.style.height = Math.min(el.scrollHeight, 140) + "px";
    }

    async function send() {
      const text = (input.value || "").trim();
      if (!text) return;

      addMessage(text, "user");
      input.value = "";
      autoGrow(input);

      sendBtn.disabled = true;
      setStatus("Thinking...", "busy");

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok) {
          addMessage(data?.error || `HTTP ${res.status}`, "bot", true);
          setStatus("Error", "err");
          return;
        }

        addMessage(data?.reply || "No response", "bot");
        setStatus("Ready", "ready");
      } catch (e) {
        addMessage(e?.message || "Request failed", "bot", true);
        setStatus("Error", "err");
      } finally {
        sendBtn.disabled = false;
        input.focus();
      }
    }

    // Send button
    sendBtn.addEventListener("click", send);

    // Enter to send, Shift+Enter for newline
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        send();
      }
    });

    // Auto-grow textarea
    input.addEventListener("input", () => autoGrow(input));

    // Initial focus
    input.focus();
  </script>
</body>
</html>
